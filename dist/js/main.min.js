$(document).ready(function(){function e(){$.debugStates.showTranscript?$(".transcript").fadeIn():$(".transcript").fadeOut(),$.debugStates.showTextInput?$(".textInput").fadeIn():$(".textInput").fadeOut(),$.debugStates.showResponse?$(".response").fadeIn():$(".response").fadeOut()}$.debugStates={debugControls:!0,debug:!0,speechDebug:!0,recognitionDebug:!0,witDebug:!0,showTranscript:!1,showTextInput:!1,showResponse:!1},$(".submitMessage").click(function(){$.apiRequest($(".messageText").val()),$(".loadingImg").show(),$(".micImg").fadeOut()}),$(".messageText").keypress(function(e){13==e.which&&($.apiRequest($(".messageText").val()),$(".messageText").val(""),$(".loadingImg").show(),$(".micImg").fadeOut())}),$.debug=function(e,t){t=t||"DEBUG";var n=!1;switch(t){case"SPEECH":$.debugStates.speechDebug&&(n=!0);break;case"WIT-API":$.debugStates.witDebug&&(n=!0);break;case"MODULE":$.debugStates.witDebug&&(n=!0);break;case"RECOGNITION":$.debugStates.recognitionDebug&&(n=!0);break;default:$.debugStates.debug&&(n=!0)}n&&console.log("["+t+"] "+e)},$(".debugSwitch").change(function(){var t=$(this).prop("checked");$.debugStates[$(this).attr("name")]=t,e()}),$.debugStates.debugControls&&$(".debugControls").fadeIn("slow"),e()}),$(document).ready(function(){var e="",t=!1,n=new webkitSpeechRecognition;n.continuous=!0,n.interimResults=!0,n.lang="en-US",n.onstart=function(){t=!0,$.debug("Recognition started","RECOGNITION"),$(".micAnimated").show()},n.onerror=function(e){$.debug("Recognition error","RECOGNITION"),$(".errorDing")[0].play(),$.sayMessage("Sorry, I encountered an error while listening")},n.onend=function(){t=!1,$(".micAnimated").hide(),$.debug("Recognition ended","RECOGNITION"),$(".speechDing")[0].play(),e.length?($.apiRequest(e),$(".loadingImg").show(),$(".micImg").fadeOut()):($(".errorDing")[0].play(),$.sayMessage("Sorry, I didn't catch that. Could you please try again?"))},n.onresult=function(o){for(var s="",a=o.resultIndex;a<o.results.length;++a)o.results[a].isFinal?e+=o.results[a][0].transcript:s+=o.results[a][0].transcript;$(".transcript").html(s),$.debug("interim:  "+s,"RECOGNITION"),$.debug("final:    "+e,"RECOGNITION"),e.length>0&&($(".transcript").html(e),n.stop(),t=!1)},$(".micImg").click(function(o){o.preventDefault(),t?(n.stop(),t=!1):(e="",n.start(),$(".transcript").html(""))})}),$(document).ready(function(){function e(e){return Math.floor(Math.random()*(Math.floor(e/2)+Math.floor(e/2)))}var t=[],n=!1,o=0,s={0:"Hello, how can I be of assistance?",1:"Hello again, how can I be of assistance?",2:"Hi there, how can I be of assistance?",3:"How can I be of assistance?",4:"Hello, what can I do for you?",5:"Hello again, what can I do for you?",6:"Hi there, what can I do for you?",7:"What can I do for you?",8:"Hello, how can I help you?",9:"Hello again, how can I help you?",10:"Hi there, how can I help you?",11:"How can I help you?"},a=0,u={0:"Give me a moment to look that up for you",1:"Give me a moment to find that for you",2:"Sure thing, give me a moment to find that for you",3:"No problem, please wait while I check that for you",4:"Got it, give me a moment to look that up",5:"I'll have that information for you in just a moment",6:"Give me a moment to look that up",7:"That will take just a moment to look up",8:"Got it, give me a moment to find that"};$.processSpeechQueue=function(){if(t.length>0&&n===!1){var e=new SpeechSynthesisUtterance(t[0]);e.lang="en-GB",console.log(e),speechSynthesis.cancel(),console.log(e),speechSynthesis.speak(e),$.debug("Issued speech command","SPEECH"),e.onstart=function(e){$.debug("Start","SPEECH"),n=!0},e.onend=function(e){speechSynthesis.cancel(),t.shift(),n=!1,$(".loadingImg").fadeOut(function(){$(".micStandard").fadeIn()}),$.debug("End","SPEECH")}}},$.sayMessage=function(e){$.debug("Queued message: "+e,"SPEECH"),t.push(e)},$.lowConfidence=function(){$.sayMessage("I'm not sure I understood that, could you please rephrase the question?")},$.sayProcessing=function(){$.sayMessage(u[a]),a++,a===Object.keys(u).length&&(a=0)},$.greetUser=function(){t.push(s[o]),$.processSpeechQueue(),setInterval("$.processSpeechQueue()",1e3)},o=e(Object.keys(s).length),a=e(Object.keys(u).length),$.debug("Intro Index: "+o),$.debug("Proccessing Index: "+a),$.greetUser()}),$(document).ready(function(){$.apiRequest=function(e){$.debug("Sending message: "+e,"WIT-API"),$.ajax({url:"https://api.wit.ai/message",data:{q:e,access_token:"JTLAYL74TLLX6CQJ433IOQALQPLUEPGP"},dataType:"jsonp",method:"GET",success:function(e){var t=e.outcomes[0].intent,n=e.outcomes[0].entities,o=e.outcomes[0].confidence,s=e._text;$.debug("Message: "+s,"WIT-API"),$.debug("Command: "+t,"WIT-API"),$.debug("Confidence: "+o,"WIT-API"),$.debug("---- Entities ----","WIT-API"),console.log(n),"UNKNOWN"==t?$.sayMessage("Sorry, I don't yet recognize that command"):.5>o?($.debug("Low confidence: "+o,"WIT-API"),$.lowConfidence()):$.post("modules/"+t+".php",{data:JSON.stringify(n)}).done(function(e){$.debugStates.showResponse&&$("#response").html(e),$.debug("Data returned: "+e,"MODULE"),$.sayMessage(e.length?e:"Sorry, I encountered an error while looking that up")})}})}});